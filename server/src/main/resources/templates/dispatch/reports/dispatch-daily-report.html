<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Dispatch Daily Report</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .header { text-align: center; border-bottom: 2px solid #333; padding-bottom: 20px; margin-bottom: 30px; }
        .logo { max-width: 200px; height: auto; }
        .title { font-size: 24px; font-weight: bold; color: #333; margin: 10px 0; }
        .date-info { font-size: 14px; color: #666; }
        .summary { background: #f5f5f5; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .summary-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; }
        .metric { text-align: center; }
        .metric-value { font-size: 28px; font-weight: bold; color: #2563eb; }
        .metric-label { font-size: 12px; color: #666; text-transform: uppercase; }
        .table { width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 10px; }
        .table th, .table td { border: 1px solid #ddd; padding: 4px 6px; text-align: left; vertical-align: top; }
        .table th { background: #f5f5f5; font-weight: bold; font-size: 9px; }
        .table th:nth-child(1), .table td:nth-child(1) { width: 60px; white-space: nowrap; }
        .table th:nth-child(10), .table td:nth-child(10) { width: 120px; }
        .delay-reasons { font-size: 12px; }
        .footer { margin-top: 40px; text-align: center; font-size: 12px; color: #666; }
    </style>
</head>
<body>
    <div class="header">
        <img th:if="${logoBase64}" th:src="${logoBase64}" alt="Logo" class="logo"/>
        <div class="title" th:text="${reportTitle}">Dispatch Daily Report</div>
        <div class="date-info">
            Report Period: <span th:text="${startDate}">Start Date</span> to <span th:text="${endDate}">End Date</span><br/>
            Generated: <span th:text="${generatedDate}">Today</span>
        </div>
    </div>

    <div class="summary">
        <h3>Summary Statistics</h3>
        <div class="summary-grid">
            <div class="metric">
                <div class="metric-value" th:text="${summary.totalTrips}">0</div>
                <div class="metric-label">Total Trips</div>
            </div>
            <div class="metric">
                <div class="metric-value" th:text="${summary.completedTrips}">0</div>
                <div class="metric-label">Completed</div>
            </div>
            <div class="metric">
                <div class="metric-value" th:text="${summary.cancelledTrips}">0</div>
                <div class="metric-label">Cancelled</div>
            </div>
            <div class="metric">
                <div class="metric-value" th:text="${summary.avgOnTimeRate} + '%'">0%</div>
                <div class="metric-label">On-Time Rate</div>
            </div>
        </div>
    </div>

    <h3>Daily Breakdown</h3>
    <table class="table">
        <thead>
            <tr>
                <th>Date</th>
                <th>Total Trips</th>
                <th>Scheduled</th>
                <th>In Progress</th>
                <th>Cancelled</th>
                <th>Completed</th>
                <th>On-Time %</th>
                <th>Avg Delay (min)</th>
                <th>Late Trips</th>
                <th>Top Delay Reasons</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="row : ${reportData}">
                <td th:text="${row.date}">Date</td>
                <td th:text="${row.totalTrips}">0</td>
                <td th:text="${row.scheduledTrips}">0</td>
                <td th:text="${row.inProgressTrips}">0</td>
                <td th:text="${row.cancelledTrips}">0</td>
                <td th:text="${row.completedTrips}">0</td>
                <td th:text="${row.onTimeRatePercent} + '%'">0%</td>
                <td th:text="${row.avgDelayMinutes}">0</td>
                <td th:text="${row.lateTrips}">0</td>
                <td class="delay-reasons">
                    <div th:if="${row.topDelayReasons != null and !row.topDelayReasons.empty}" th:each="reason : ${row.topDelayReasons}">
                        <span th:text="${reason.reason} + ' (' + ${reason.count} + ')'">Reason (count)</span><br/>
                    </div>
                    <span th:if="${row.topDelayReasons == null or row.topDelayReasons.empty}">â€”</span>
                </td>
            </tr>
        </tbody>
    </table>

    <div class="footer">
        <p>This report was automatically generated by LogiFlow Dispatch System</p>
        <p>Delay calculations: max(0, (actual - scheduled) - SLA extension minutes)</p>
    </div>
</body>
</html>
